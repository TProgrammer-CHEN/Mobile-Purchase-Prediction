#user-category
create table uc_feature_train as 
select user_id,item_category,
count(case when behavior_type=1 and hours<=6 then behavior_type end) as usercategory_bh1_6h1,
count(case when behavior_type=2 and hours<=6 then behavior_type end) as usercategory_bh2_6h1,
count(case when behavior_type=3 and hours<=6 then behavior_type end) as usercategory_bh3_6h1,
count(case when behavior_type=4 and hours<=6 then behavior_type end) as usercategory_bh4_6h1,
count(case when behavior_type=1 and hours>6 and hours<=12 then behavior_type end) as usercategory_bh1_6h2,
count(case when behavior_type=2 and hours>6 and hours<=12 then behavior_type end) as usercategory_bh2_6h2,
count(case when behavior_type=3 and hours>6 and hours<=12 then behavior_type end) as usercategory_bh3_6h2,
count(case when behavior_type=4 and hours>6 and hours<=12 then behavior_type end) as usercategory_bh4_6h2,
count(case when behavior_type=1 and hours>12 and hours<=18 then behavior_type end) as usercategory_bh1_6h3,
count(case when behavior_type=2 and hours>12 and hours<=18 then behavior_type end) as usercategory_bh2_6h3,
count(case when behavior_type=3 and hours>12 and hours<=18 then behavior_type end) as usercategory_bh3_6h3,
count(case when behavior_type=4 and hours>12 and hours<=18 then behavior_type end) as usercategory_bh4_6h3,
count(case when behavior_type=1 and hours>18 and hours<=24 then behavior_type end) as usercategory_bh1_6h4,
count(case when behavior_type=2 and hours>18 and hours<=24 then behavior_type end) as usercategory_bh2_6h4,
count(case when behavior_type=3 and hours>18 and hours<=24 then behavior_type end) as usercategory_bh3_6h4,
count(case when behavior_type=4 and hours>18 and hours<=24 then behavior_type end) as usercategory_bh4_6h4,
count(case when behavior_type=1 and hours<=12 then behavior_type end) as usercategory_bh1_12h1,
count(case when behavior_type=2 and hours<=12 then behavior_type end) as usercategory_bh2_12h1,
count(case when behavior_type=3 and hours<=12 then behavior_type end) as usercategory_bh3_12h1,
count(case when behavior_type=4 and hours<=12 then behavior_type end) as usercategory_bh4_12h1,
count(case when behavior_type=1 and hours>12 and hours<=24 then behavior_type end) as usercategory_bh1_12h2,
count(case when behavior_type=2 and hours>12 and hours<=24 then behavior_type end) as usercategory_bh2_12h2,
count(case when behavior_type=3 and hours>12 and hours<=24 then behavior_type end) as usercategory_bh3_12h2,
count(case when behavior_type=4 and hours>12 and hours<=24 then behavior_type end) as usercategory_bh4_12h2,
count(case when behavior_type=1 and hours>24 and hours<=36 then behavior_type end) as usercategory_bh1_12h3,
count(case when behavior_type=2 and hours>24 and hours<=36 then behavior_type end) as usercategory_bh2_12h3,
count(case when behavior_type=3 and hours>24 and hours<=36 then behavior_type end) as usercategory_bh3_12h3,
count(case when behavior_type=4 and hours>24 and hours<=36 then behavior_type end) as usercategory_bh4_12h3,
count(case when behavior_type=1 and hours>36 and hours<=48 then behavior_type end) as usercategory_bh1_12h4,
count(case when behavior_type=2 and hours>36 and hours<=48 then behavior_type end) as usercategory_bh2_12h4,
count(case when behavior_type=3 and hours>36 and hours<=48 then behavior_type end) as usercategory_bh3_12h4,
count(case when behavior_type=4 and hours>36 and hours<=48 then behavior_type end) as usercategory_bh4_12h4,
count(case when behavior_type=1 and hours<=24 then behavior_type end) as usercategory_bh1_1d1,
count(case when behavior_type=2 and hours<=24 then behavior_type end) as usercategory_bh2_1d1,
count(case when behavior_type=3 and hours<=24 then behavior_type end) as usercategory_bh3_1d1,
count(case when behavior_type=4 and hours<=24 then behavior_type end) as usercategory_bh4_1d1,
count(case when behavior_type=1 and hours>24 and hours<=48 then behavior_type end) as usercategory_bh1_1d2,
count(case when behavior_type=2 and hours>24 and hours<=48 then behavior_type end) as usercategory_bh2_1d2,
count(case when behavior_type=3 and hours>24 and hours<=48 then behavior_type end) as usercategory_bh3_1d2,
count(case when behavior_type=4 and hours>24 and hours<=48 then behavior_type end) as usercategory_bh4_1d2,
count(case when behavior_type=1 and hours>48 and hours<=72 then behavior_type end) as usercategory_bh1_1d3,
count(case when behavior_type=2 and hours>48 and hours<=72 then behavior_type end) as usercategory_bh2_1d3,
count(case when behavior_type=3 and hours>48 and hours<=72 then behavior_type end) as usercategory_bh3_1d3,
count(case when behavior_type=4 and hours>48 and hours<=72 then behavior_type end) as usercategory_bh4_1d3,
count(case when behavior_type=1 and hours>72 and hours<=96 then behavior_type end) as usercategory_bh1_1d4,
count(case when behavior_type=2 and hours>72 and hours<=96 then behavior_type end) as usercategory_bh2_1d4,
count(case when behavior_type=3 and hours>72 and hours<=96 then behavior_type end) as usercategory_bh3_1d4,
count(case when behavior_type=4 and hours>72 and hours<=96 then behavior_type end) as usercategory_bh4_1d4,
min(case when behavior_type=1 then hours end) as usercategory_recent_bh1,
min(case when behavior_type=2 then hours end) as usercategory_recent_bh2,
min(case when behavior_type=3 then hours end) as usercategory_recent_bh3,
min(case when behavior_type=4 then hours end) as usercategory_recent_bh4
from user_train 
group by user_id,item_category;

create table uc_feature as 
select user_id,item_category,
count(case when behavior_type=1 and hours<=6 then behavior_type end) as usercategory_bh1_6h1,
count(case when behavior_type=2 and hours<=6 then behavior_type end) as usercategory_bh2_6h1,
count(case when behavior_type=3 and hours<=6 then behavior_type end) as usercategory_bh3_6h1,
count(case when behavior_type=4 and hours<=6 then behavior_type end) as usercategory_bh4_6h1,
count(case when behavior_type=1 and hours>6 and hours<=12 then behavior_type end) as usercategory_bh1_6h2,
count(case when behavior_type=2 and hours>6 and hours<=12 then behavior_type end) as usercategory_bh2_6h2,
count(case when behavior_type=3 and hours>6 and hours<=12 then behavior_type end) as usercategory_bh3_6h2,
count(case when behavior_type=4 and hours>6 and hours<=12 then behavior_type end) as usercategory_bh4_6h2,
count(case when behavior_type=1 and hours>12 and hours<=18 then behavior_type end) as usercategory_bh1_6h3,
count(case when behavior_type=2 and hours>12 and hours<=18 then behavior_type end) as usercategory_bh2_6h3,
count(case when behavior_type=3 and hours>12 and hours<=18 then behavior_type end) as usercategory_bh3_6h3,
count(case when behavior_type=4 and hours>12 and hours<=18 then behavior_type end) as usercategory_bh4_6h3,
count(case when behavior_type=1 and hours>18 and hours<=24 then behavior_type end) as usercategory_bh1_6h4,
count(case when behavior_type=2 and hours>18 and hours<=24 then behavior_type end) as usercategory_bh2_6h4,
count(case when behavior_type=3 and hours>18 and hours<=24 then behavior_type end) as usercategory_bh3_6h4,
count(case when behavior_type=4 and hours>18 and hours<=24 then behavior_type end) as usercategory_bh4_6h4,
count(case when behavior_type=1 and hours<=12 then behavior_type end) as usercategory_bh1_12h1,
count(case when behavior_type=2 and hours<=12 then behavior_type end) as usercategory_bh2_12h1,
count(case when behavior_type=3 and hours<=12 then behavior_type end) as usercategory_bh3_12h1,
count(case when behavior_type=4 and hours<=12 then behavior_type end) as usercategory_bh4_12h1,
count(case when behavior_type=1 and hours>12 and hours<=24 then behavior_type end) as usercategory_bh1_12h2,
count(case when behavior_type=2 and hours>12 and hours<=24 then behavior_type end) as usercategory_bh2_12h2,
count(case when behavior_type=3 and hours>12 and hours<=24 then behavior_type end) as usercategory_bh3_12h2,
count(case when behavior_type=4 and hours>12 and hours<=24 then behavior_type end) as usercategory_bh4_12h2,
count(case when behavior_type=1 and hours>24 and hours<=36 then behavior_type end) as usercategory_bh1_12h3,
count(case when behavior_type=2 and hours>24 and hours<=36 then behavior_type end) as usercategory_bh2_12h3,
count(case when behavior_type=3 and hours>24 and hours<=36 then behavior_type end) as usercategory_bh3_12h3,
count(case when behavior_type=4 and hours>24 and hours<=36 then behavior_type end) as usercategory_bh4_12h3,
count(case when behavior_type=1 and hours>36 and hours<=48 then behavior_type end) as usercategory_bh1_12h4,
count(case when behavior_type=2 and hours>36 and hours<=48 then behavior_type end) as usercategory_bh2_12h4,
count(case when behavior_type=3 and hours>36 and hours<=48 then behavior_type end) as usercategory_bh3_12h4,
count(case when behavior_type=4 and hours>36 and hours<=48 then behavior_type end) as usercategory_bh4_12h4,
count(case when behavior_type=1 and hours<=24 then behavior_type end) as usercategory_bh1_1d1,
count(case when behavior_type=2 and hours<=24 then behavior_type end) as usercategory_bh2_1d1,
count(case when behavior_type=3 and hours<=24 then behavior_type end) as usercategory_bh3_1d1,
count(case when behavior_type=4 and hours<=24 then behavior_type end) as usercategory_bh4_1d1,
count(case when behavior_type=1 and hours>24 and hours<=48 then behavior_type end) as usercategory_bh1_1d2,
count(case when behavior_type=2 and hours>24 and hours<=48 then behavior_type end) as usercategory_bh2_1d2,
count(case when behavior_type=3 and hours>24 and hours<=48 then behavior_type end) as usercategory_bh3_1d2,
count(case when behavior_type=4 and hours>24 and hours<=48 then behavior_type end) as usercategory_bh4_1d2,
count(case when behavior_type=1 and hours>48 and hours<=72 then behavior_type end) as usercategory_bh1_1d3,
count(case when behavior_type=2 and hours>48 and hours<=72 then behavior_type end) as usercategory_bh2_1d3,
count(case when behavior_type=3 and hours>48 and hours<=72 then behavior_type end) as usercategory_bh3_1d3,
count(case when behavior_type=4 and hours>48 and hours<=72 then behavior_type end) as usercategory_bh4_1d3,
count(case when behavior_type=1 and hours>72 and hours<=96 then behavior_type end) as usercategory_bh1_1d4,
count(case when behavior_type=2 and hours>72 and hours<=96 then behavior_type end) as usercategory_bh2_1d4,
count(case when behavior_type=3 and hours>72 and hours<=96 then behavior_type end) as usercategory_bh3_1d4,
count(case when behavior_type=4 and hours>72 and hours<=96 then behavior_type end) as usercategory_bh4_1d4,
min(case when behavior_type=1 then hours end) as usercategory_recent_bh1,
min(case when behavior_type=2 then hours end) as usercategory_recent_bh2,
min(case when behavior_type=3 then hours end) as usercategory_recent_bh3,
min(case when behavior_type=4 then hours end) as usercategory_recent_bh4
from user_test 
group by user_id,item_category;